"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}(function(){var slice=[].slice;var internalFind=function internalFind(context,selector){return slice.call((context||document.body).querySelectorAll(":scope "+selector.trim()))};var find=function find(context,selector){if(selector==null){if(typeof context=="string"){selector=context;context=null}else{return internalFind.bind(void 0,context)}}return internalFind(context,selector)};var find_node_default=find;var delegate=function delegate(fn,selector){return function handler(event2){var matchingEl=matches(event2.target,selector,this);if(matchingEl!=null){fn.call(matchingEl,event2)}}};var delegate_default=delegate;var matches=function matches(target,selector,boundElement){if(target===boundElement){return null}if(target.matches(selector)){return target}if(target.parentNode){return matches(target.parentNode,selector,boundElement)}return null};var listen2=function listen2(eventName,target,fn){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var _options$useCapture=options.useCapture,useCapture=_options$useCapture===void 0?false:_options$useCapture;var handler=options.once?once(fn,cancelListener):fn;target.addEventListener(eventName,handler,useCapture);var cancelListener=function cancelListener(){target.removeEventListener(eventName,handler,useCapture)};return cancelListener};var listen_default=listen2;function once(fn,cancel){return function(){cancel();for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}fn.apply(this,args)}}var send=function send(method,url,payload){var fetchSettings=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var settings=_objectSpread(_objectSpread({},fetchSettings),{},{headers:_objectSpread({"content-type":"application/json"},fetchSettings.headers),method:method});if(payload){if(method.toUpperCase()!=="GET"){settings.body=JSON.stringify(payload)}else{var qs=new URLSearchParams(payload);url+="?"+qs.toString()}}return fetch(url,settings).then(function(response){var result=Promise.all([response.json(),response]);if(response.ok){return result}return result.then(function(_ref){var _ref2=_slicedToArray(_ref,1),error=_ref2[0];return Promise.reject(error)})})};var fetch_default=send;var ESC=27;var ARROW_DOWN=40;var ARROW_UP=38;var tryFocus=function tryFocus(el){if(el){el.focus()}};var Autocomplete=function(){function Autocomplete(el,config){var _this=this;_classCallCheck(this,Autocomplete);_defineProperty(this,"onBlur",function(){window.requestAnimationFrame(function(){if(_this.rootEl.contains(document.activeElement)===false){_this.hideResultBox()}})});_defineProperty(this,"onFocus",function(event2){if(event2.target.value){_this.showResultBox()}});_defineProperty(this,"onKeyup",function(event2){if(event2.target.value===""){_this.hideResultBox();return}var matches2=_this.filter(_this.results,event2.target.value);if(matches2.length===0){_this.renderZeroResults()}else{_this.renderResults(matches2)}_this.showResultBox()});_defineProperty(this,"onButtonClick",function(event2){if(typeof _this.onSelect=="function"){var key=event2.target.dataset.key;var selectedEntry=_this.results.find(function(entry){return entry.key===key});(0,_this.onSelect)(selectedEntry);_this.hideResultBox()}});_defineProperty(this,"onClickOutside",function(event2){if(_this.rootEl.contains(event2.target)===false){_this.hideResultBox()}});_defineProperty(this,"onKeys",function(event2){switch(event2.which){case ESC:_this.hideResultBox();case ARROW_DOWN:case ARROW_UP:event2.preventDefault();case ARROW_DOWN:_this.selectNext();break;case ARROW_UP:_this.selectPrev();break;}});this.rootEl=el;this.$list=find_node_default(el,".js-list")[0];this.endpoint=config.endpoint;this.filter=config.onSearch;this.onSelect=config.onSelect}_createClass(Autocomplete,[{key:"mount",value:function mount(){var _this2=this;this.loadData().then(function(){_this2.registerEvents()})}},{key:"destroy",value:function destroy(){}},{key:"registerEvents",value:function registerEvents(){listen_default("keyup",this.rootEl,delegate_default(this.onKeyup,"input"));listen_default("focusin",this.rootEl,delegate_default(this.onFocus,"input"));listen_default("focusout",this.rootEl,delegate_default(this.onBlur,"input"));listen_default("click",this.rootEl,delegate_default(this.onButtonClick,"button"))}},{key:"loadData",value:function loadData(){var _this3=this;return fetch_default("GET",this.endpoint).then(function(_ref3){var _ref4=_slicedToArray(_ref3,1),results=_ref4[0];_this3.results=results})}},{key:"renderZeroResults",value:function renderZeroResults(){this.$list.innerHTML="\n      <ul class=\"result-list empty\">\n        <li>\n          No results.\n        </li>\n      </ul>"}},{key:"renderResults",value:function renderResults(matches2){this.$list.innerHTML="\n      <ul class=\"result-list\">\n        ".concat(matches2.map(function(entry){return"\n                  <li class=\"result\">\n                    <button type=\"button\" data-key=\"".concat(entry.key,"\">").concat(entry.name,"</button>\n                  </li>")}).join(""),"\n      </ul>")}},{key:"showResultBox",value:function showResultBox(){this.rootEl.classList.add("expanded");this.stopListenOutsideClick=listen_default("click",document.body,this.onClickOutside);this.stopListenKeys=listen_default("keydown",document,this.onKeys)}},{key:"hideResultBox",value:function hideResultBox(){this.rootEl.classList.remove("expanded");if(this.stopListenOutsideClick){this.stopListenOutsideClick()}if(this.stopListenKeys){this.stopListenKeys()}}},{key:"selectNext",value:function selectNext(){var $buttons=find_node_default(this.$list,"button");var currentIdx=$buttons.indexOf(document.activeElement);var $nextBtn=currentIdx<0||currentIdx+1>=$buttons.length?$buttons[0]:$buttons[currentIdx+1];tryFocus($nextBtn)}},{key:"selectPrev",value:function selectPrev(){var $buttons=find_node_default(this.$list,"button");var currentIdx=$buttons.indexOf(document.activeElement);var $prevBtn=currentIdx<0||currentIdx-1<0?$buttons[$buttons.length-1]:$buttons[currentIdx-1];tryFocus($prevBtn)}}]);return Autocomplete}();var installWidget=function installWidget(el,config){var widget=new Autocomplete(el,config);widget.mount()};var autocomplete_default=installWidget;var Card=function(){function Card(el,config){_classCallCheck(this,Card);this.rootEl=el;this.locale=config.locale;this.getEndpoint=config.endpoint;this.translations=_defineProperty({},this.locale,null)}_createClass(Card,[{key:"mount",value:function mount(){}},{key:"destroy",value:function destroy(){}},{key:"render",value:function render(card){var _this4=this;if(this.translations[this.locale]==null){this.loadData().then(function(){_this4.render(card)});return}var cardLocale=this.translations[this.locale].find(function(entry){return entry.key===card.key});this.rootEl.innerHTML="\n      <div class=\"card\">\n        <div class=\"card-title-original\">".concat(card.name,"</div>\n        <h2 class=\"card-title-locale\">").concat(cardLocale.name,"</h2>\n        <div class=\"card-body\">\n          <div class=\"card-img-box\">\n            <img class=\"card-img\" src=\"/images/cards/").concat(card.key,".jpeg\" alt=\"\" />\n          </div>\n          <div class=\"card-description\">\n            <div class=\"card-description-original\">\n              <p>").concat(card.description||"","</p>\n            </div>\n            <div class=\"card-description-locale\">\n              <p>").concat(cardLocale.description||"","</p>\n            </div>\n          </div>\n        </div>\n      </div>")}},{key:"loadData",value:function loadData(){var _this5=this;var endpoint=this.getEndpoint(this.locale);return fetch_default("GET",endpoint).then(function(_ref5){var _ref6=_slicedToArray(_ref5,1),results=_ref6[0];_this5.translations[_this5.locale]=results})}}]);return Card}();var installWidget2=function installWidget2(el,config){var widget=new Card(el,config);return widget};var card_localizer_default=installWidget2;(function Main(){var $autocompleteEl=find_node_default(".js-autocomplete");if($autocompleteEl.length){var $cardEl=find_node_default(".js-card");var cardWidget=card_localizer_default($cardEl[0],{endpoint:function endpoint(locale){return"/cards-".concat(locale,".json")},locale:"it"});autocomplete_default($autocompleteEl[0],{endpoint:"/cards.json",onSearch:function onSearch(results,query){query=query.toLowerCase();var resultsStartingWithQuery=results.filter(function(entry){return entry.name.toLowerCase().startsWith(query)});if(resultsStartingWithQuery.length>=5){return resultsStartingWithQuery.slice(0,5)}var resultsMatchingQuery=results.filter(function(entry){return entry.name.toLowerCase().indexOf(query)>0});var matches2=resultsStartingWithQuery.concat(resultsMatchingQuery);return matches2.slice(0,5)},onSelect:function onSelect(selectedElement){cardWidget.render(selectedElement)}})}})()})();

